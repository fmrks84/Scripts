SELECT 
*
FROM
(
SELECT 
DECODE (ROW_NUMBER()OVER (PARTITION BY SP.CD_ATENDIMENTO ORDER BY SP.CD_ATENDIMENTO),1,(MVT.DT_LIB_MOV - MVT.DT_MOV_INT)*24,NULL) HORAS,
DECODE (ROW_NUMBER()OVER (PARTITION BY SP.CD_ATENDIMENTO ORDER BY SP.CD_ATENDIMENTO),1,(UIN.DS_UNID_INT), NULL) UNID_INTERNACAO,
DECODE (ROW_NUMBER()OVER (PARTITION BY SP.CD_ATENDIMENTO ORDER BY SP.CD_ATENDIMENTO),1,(LT.CD_LEITO||' - '||LT.DS_LEITO), NULL) DS_LEITO,
DECODE (ROW_NUMBER()OVER (PARTITION BY SP.CD_ATENDIMENTO ORDER BY SP.CD_ATENDIMENTO),1,(ST.CD_SETOR||' - '||ST.NM_SETOR), NULL) NM_SETOR,
SP.CD_ATENDIMENTO,
sp.cd_pre_med,
sp.cd_solsai_pro,
isp.cd_itsolsai_pro,
ISP.CD_PRODUTO,
PD.DS_PRODUTO,
pd.cd_especie||' - '||esp.ds_especie especie,
pd.cd_classe||' - '||CLS.DS_CLASSE classe,
pd.cd_sub_cla||' - '||SCLS.DS_SUB_CLA subclasse,
ISP.QT_SOLICITADO,
ISP.QT_ATENDIDA,
(ISP.QT_SOLICITADO - ISP.QT_ATENDIDA)QTD_NAO_UTILIZADO,
ATD.CD_MULTI_EMPRESA
FROM 
SOLSAI_PRO SP 
INNER JOIN ITSOLSAI_PRO ISP ON ISP.CD_SOLSAI_PRO = SP.CD_SOLSAI_PRO
INNER JOIN ITPRE_MED IPM ON IPM.CD_ITPRE_MED = ISP.CD_ITPRE_MED
INNER JOIN PRE_MED PM ON PM.CD_PRE_MED = IPM.CD_PRE_MED
INNER JOIN TIP_PRESC TP ON TP.CD_TIP_PRESC = ISP.CD_TIP_PRESC 
INNER JOIN SETOR ST ON ST.CD_SETOR = SP.CD_SETOR
INNER JOIN PRODUTO PD ON PD.CD_PRODUTO = ISP.CD_PRODUTO
INNER JOIN ATENDIME ATD ON ATD.CD_ATENDIMENTO = SP.CD_ATENDIMENTO
INNER JOIN UNID_INT UIN ON UIN.CD_UNID_INT = SP.CD_UNID_INT
INNER JOIN SETOR ST ON ST.CD_SETOR = SP.CD_SETOR
INNER JOIN LEITO LT ON LT.CD_LEITO = ATD.CD_LEITO AND LT.CD_UNID_INT = SP.CD_UNID_INT
INNER JOIN MOV_INT MVT ON MVT.CD_LEITO = LT.CD_LEITO AND MVT.CD_ATENDIMENTO = SP.CD_ATENDIMENTO
INNER JOIN ESPECIE ESP ON ESP.CD_ESPECIE = PD.CD_ESPECIE 
INNER JOIN CLASSE CLS ON CLS.CD_ESPECIE = ESP.CD_ESPECIE AND CLS.CD_CLASSE = PD.CD_CLASSE
INNER JOIN SUB_CLAS SCLS ON SCLS.CD_CLASSE = CLS.CD_CLASSE AND SCLS.CD_SUB_CLA = PD.CD_SUB_CLA
AND SCLS.CD_ESPECIE = PD.CD_ESPECIE
WHERE ATD.DT_ATENDIMENTO BETWEEN '01/01/2023' AND '31/01/2023' -- FILTRO DATA ATENDIMENTO 
AND UIN.DS_UNID_INT LIKE 'UTI%'
AND TP.CD_PRODUTO IS NOT NULL
AND SP.TP_SITUACAO NOT IN ('A')
--AND SP.CD_SOLSAI_PRO = 23176655
)WHERE (HORAS > 24 OR HORAS IS NULL OR HORAS <> 0) --- AQUI IRÁ TRAZER OS PACIENTES QUE FICARAM POR MAIS DE 24HORAS
AND CD_MULTI_EMPRESA = 7  --- FILTRO CODIGO_EMPRESA 
ORDER BY CD_ATENDIMENTO,HORAS,CD_SOLSAI_PRO

