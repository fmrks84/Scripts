SELECT  
B.CD_CONVENIO,
B.NM_CONVENIO,
D.CD_CON_PLA,
D.DS_CON_PLA,
G.CD_PRO_FAT,
G2.DS_PRO_FAT,
G.VL_TOTAL,
CASE WHEN C.SN_PERMITE_AMBULATORIO = 'S' THEN 'PERMITE' ELSE 'NÃO_PERMITE' END PORTA_AMBULATORIO,
CASE WHEN C.SN_PERMITE_INTERNACAO = 'S' THEN 'PERMITE' ELSE 'NÃO_PERMITE' END PORTA_INTERNACAO,
G.VL_HONORARIO,
G.VL_OPERACIONAL,
G.VL_TOTAL,
G.DT_VIGENCIA
FROM EMPRESA_CONVENIO A
INNER JOIN CONVENIO B ON B.CD_CONVENIO = A.CD_CONVENIO 
INNER JOIN EMPRESA_CON_PLA C ON C.CD_CONVENIO = A.CD_CONVENIO
INNER JOIN CON_PLA D ON D.CD_CONVENIO = A.CD_CONVENIO AND D.CD_CON_PLA = C.CD_CON_PLA
INNER JOIN ITREGRA E ON E.CD_REGRA = C.CD_REGRA 
INNER JOIN TAB_FAT F ON F.CD_TAB_FAT = E.CD_TAB_FAT
INNER JOIN VAL_PRO G ON G.CD_TAB_FAT = E.CD_TAB_FAT AND G.CD_TAB_FAT = E.CD_TAB_FAT
INNER JOIN PRO_FAT G2 ON G2.CD_PRO_FAT = G.CD_PRO_FAT
WHERE G.DT_VIGENCIA = (SELECT MAX(G1.DT_VIGENCIA)FROM VAL_PRO G1 WHERE G1.CD_PRO_FAT = G.CD_PRO_FAT
                                                                   AND G1.CD_TAB_FAT = G.CD_TAB_FAT)
AND B.CD_CONVENIO = 11
AND D.CD_CON_PLA IN (1,2,3,4,5,6,7,8)
AND G.CD_TAB_FAT IN (301,31)
AND (C.SN_PERMITE_AMBULATORIO IN ('S','N') OR C.SN_PERMITE_INTERNACAO IN ('S','N'))
AND G.CD_PRO_FAT IN ('40502074' 
,'40502171' 
,'40502090' 
,'40311465' 
,'40309266' 
,'40312020' 
,'40312020' 
,'40304493' 
,'40304906' 
,'40503097' 
,'40301982' 
,'40314081' 
,'20102038' 
,'20102038' 
,'40312127' 
,'40312127' 
,'40304493' 
,'40304493' 
,'40312143' 
,'40312143' 
,'40312143' 
,'40312143' 
,'40101037' 
,'41401174' 
,'40302610' 
,'40503020' 
,'40503011' 
,'40503348' 
,'40503046' 
,'40503151' 
,'40503054' 
,'40503640' 
,'40503372' 
,'40503844' 
,'40503356' 
,'40503771' 
,'40323552' 
,'40501230' 
,'40503445' 
,'40503836' 
,'40503062' 
,'40314430' 
,'40306887' 
,'40501230' 
,'40314251' 
,'40501019' 
,'40501078' 
,'40701069' 
,'40701140' 
,'40701131' 
,'40314022' 
,'30911117' 
,'30912156' 
,'30911117' 
,'40503089' 
,'40314057' 
,'40314413' 
,'40314090' 
,'40314103' 
,'40501183' 
,'40501191' 
,'40304906' 
,'40503097' 
,'40301982' 
,'40306887' 
,'20102038' 
,'40312127' 
,'40304493' 
,'40312143')
GROUP BY 
B.CD_CONVENIO,
B.NM_CONVENIO,
D.CD_CON_PLA,
D.DS_CON_PLA,
G.CD_PRO_FAT,
G2.DS_PRO_FAT,
G.VL_TOTAL,
C.SN_PERMITE_AMBULATORIO,
C.SN_PERMITE_INTERNACAO,
G.VL_HONORARIO,
G.VL_OPERACIONAL,
G.VL_TOTAL,
G.DT_VIGENCIA
ORDER BY  G.CD_PRO_FAT





/*select  * from itregra z 
inner join tab_Fat z1 on z1.cd_tab_fat = z.cd_tab_fat
where z.cd_regra in (45,61)
AND Z.CD_GRU_PRO in (20,
21,
22,
23,
24,
27,
28,
30,
31,
32,
33,
34,
39,
42,
49,
52,
63,
64,
69,
86,
90)*/
