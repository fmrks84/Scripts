--- 01/01/2022 - 18-04-2023--
with op as (
select p.cd_produto,
       replace(p.ds_produto,';',',')ds_produto,
       SubStr(p.ds_produto,instr(p.ds_produto,'REF')+4,50) CAMPO_REF,
       p.cd_especie,
       replace(e.ds_especie,';',',')ds_especie,
       p.cd_classe,
       replace(c.ds_classe,';',',')ds_classe,
       p.cd_sub_cla,
       replace(sub.ds_sub_cla,';',',')ds_sub_cla,
       p.sn_mestre,
       p.cd_produto_tem ,
       replace(m.ds_produto,';',',') ds_mestre,
       p.sn_bloqueio_de_compra,
       p.sn_movimentacao,
       p.sn_controle_validade,
       p.sn_padronizado,
       p.sn_pscotropico ,
       replace(u.ds_unidade,';',',') unidade_ref,
       p.cd_tip_ativ ,
       a.ds_tip_ativ,
       p.cd_lista_codigo_medicamento,
       p.ds_produto_resumido,
       p.dt_ultima_entrada,
       P.vl_ultima_entrada,
       SUM(ep.qt_estoque_atual) saldo,
       P.cd_pro_fat,
       pf.cd_gru_pro,
       gp.ds_gru_pro,
       simp.cd_simpro,
       simp.cd_tuss,
       P.sn_kit,
       P.tp_atualizacao_preco,
       P.tp_cx_cirurgica,
       P.tp_carater,
       P.sn_opme,
       DECODE(P.sn_consignado,'R','REPROCESSADO', 'S', 'CONSIGNADO', 'N', 'NORMAL', NULL)TIP_PRODUTO,
       empresa_produto.cd_multi_empresa,
       EMPRESA_PRODUTO.TP_CLASSIFICACAO_ABC

  from dbamv.produto p,
       dbamv.especie e,
       dbamv.classe c,
       dbamv.sub_clas sub,
       dbamv.produto m,
       dbamv.tip_ativ a,
       dbamv.uni_pro u,
       dbamv.est_pro ep,
       dbamv.empresa_produto,
       dbamv.pro_fat pf,
       dbamv.gru_pro gp,
       dbamv.imp_simpro simp

 Where p.cd_especie = e.cd_especie
   and p.cd_classe = c.cd_classe
   and p.cd_especie = c.cd_especie
   and c.cd_especie = e.cd_especie
   and p.cd_sub_cla = sub.cd_sub_cla
   and p.cd_classe = sub.cd_classe
   and p.cd_especie = sub.cd_especie
   and c.cd_classe = sub.cd_classe
   AND p.cd_produto = ep.cd_produto(+)
   and p.cd_produto_tem = m.cd_produto(+)
   and p.cd_tip_ativ = a.cd_tip_ativ(+)
   and u.cd_produto = p.cd_produto
   and pf.cd_pro_fat = p.cd_pro_fat
   and gp.cd_gru_pro = pf.cd_gru_pro
   and simp.cd_pro_fat = p.cd_pro_fat(+)
   and u.tp_relatorios = 'R'
   and empresa_produto.cd_produto = p.cd_produto
   AND  p.cd_especie in (19,20)
   AND  P.CD_CLASSE IN (3,1)
   AND P.CD_SUB_CLA IN (2,5,7,8,9,10,12,14,17)
   AND  empresa_produto.cd_multi_empresa = 7-- --{cdMultiEmpresa}
   AND p.cd_produto IN (SELECT cd_produto FROM dbamv.empresa_produto)
Group By p.cd_produto,
       p.ds_produto,
       p.cd_especie,
       e.ds_especie,
       p.cd_classe,
       c.ds_classe,
       p.cd_sub_cla,
       sub.ds_sub_cla,
       p.sn_mestre,
       p.cd_produto_tem ,
       m.ds_produto ,
       p.sn_bloqueio_de_compra,
       p.sn_controle_validade,
       p.sn_padronizado,
       p.sn_pscotropico ,
       u.ds_unidade ,
       p.cd_tip_ativ ,
       a.ds_tip_ativ,
       p.cd_lista_codigo_medicamento,
       p.ds_produto_resumido,
       p.dt_ultima_entrada ,
       P.vl_ultima_entrada,
       p.sn_movimentacao,
       P.ds_produto_resumidO,
       P.cd_pro_fat,
        pf.cd_gru_pro,
       gp.ds_gru_pro,
        simp.cd_simpro,
       simp.cd_tuss,
       P.sn_kit,
       P.tp_atualizacao_preco,
       P.tp_cx_cirurgica,
       P.tp_carater,
       P.sn_opme,
       P.sn_consignado,
       empresa_produto.cd_multi_empresa,
       EMPRESA_PRODUTO.TP_CLASSIFICACAO_ABC
order by p.cd_especie, p.ds_produto
)

select
opme.cd_produto,
opme.ds_produto,
opme.cd_especie,
opme.cd_classe,
opme.ds_classe,
opme.cd_multi_empresa,
pf.cd_pro_fat,
pf.ds_pro_fat,
opme.cd_gru_pro,
opme.ds_gru_pro,
opme.cd_simpro,
opme.cd_tuss,
''DESC_SIMPRO,
''CLASS_SIMPRO,
''DESC_IDENTIFICACAO,
''CONSUMO_12_MESES_VALOR,
''CONSUMO_12_MESES_QTDADE,
--ts.ds_tuss,
pf.ds_unidade,
count(*)QTD
from
atendime atd
inner join reg_fat rf on rf.cd_atendimento = atd.cd_atendimento
and rf.cd_convenio = atd.cd_convenio
inner join itreg_fat irf on irf.cd_reg_fat = rf.cd_reg_fat
inner join pro_fat pf on pf.cd_pro_fat = irf.cd_pro_fat
inner join op opme on opme.cd_pro_fat = irf.cd_pro_fat
--left join tuss ts on ts.cd_tuss = opme.cd_tuss
where to_char(atd.dt_atendimento,'dd/mm/rrrr') between '01/01/2022' and '31/12/2022'
and irf.cd_pro_fat in (70252980,
00007530,
70237921,
09004406,
70098450,
72595469,
00263562,
00276527,
70857580,
72595400,
70098573,
00263561,
09058918,
00142106,
00289275,
71385525,
70872449,
09046717,
09062480,
00131082,
00032187,
00032186,
00276539,
09005501,
00033907,
00105157,
70239517,
09004497,
70182752,
00004220,
09015391,
00161458,
00272943,
00276532,
70134510,
00250370,
00241340,
09004186,
09022345,
72594977,
70099910,
00005382,
00173856,
72595418,
70351759,
72871725,
00121623,
00241338,
00284329,
00128059,
00146772,
09002739,
09058296,
72595698,
09076399,
70103887,
71881867,
00320739,
00320741,
70134430,
00294718,
00276535,
00166131,
00241331,
71322264,
00306197,
00157119,
71321721,
72615117,
70239789,
00004325,
00160803,
00272905,
70674833,
70089817,
09046722,
00299556,
72594969,
72618930,
00285631,
00241337,
09054308,
00277321,
00277134,
70707405,
09016643,
00151251,
72595647,
09029677,
09003533,
00153170,
00252840,
00142107,
72595612,
09002432,
70120250,
00320731,
09003699,
71345582,
00280173,
00291155,
09056676,
09005774,
72094664,
70566569,
00257018,
00170127,
09004194,
71371095,
00151253,
00320732,
71322302,
72094761,
00105146,
70097127,
00250356,
70329117,
09014848,
00308908,
00133490,
00277853,
72595450,
00302916,
00241692,
09030860,
70134570,
00299491,
00284669,
70182990,
00245861,
00291160,
70251274,
09038238,
00175197,
09036741,
09011139,
70141070,
72872287,
00277133,
00278826,
00293431,
00131074,
00160566,
09020987,
00306194,
00307138,
00259725,
00299497,
00251909,
72600926,
00002564,
00263415,
00157121,
00163063,
00263411,
00289637,
00142105,
00091068,
00173855,
00251326,
00239942,
00247926,
70253846,
00291159,
00105147,
09014913,
72595558,
09000644,
78337410,
70570299,
00252839,
70240221,
70860610,
09072746,
00173805,
00285978,
70037280,
70134081,
00277136,
00277764,
00160802,
00163064,
00288720,
00170126,
70358486,
70344035,
00276596,
09015880,
00284448,
00320039,
00316292,
70228663,
09004405,
00269953,
00246184,
09037498,
09002346,
70408661,
00242421,
00137588,
09004427,
72595590,
00109095,
00297063,
00307137,
70570280,
78411726,
72095024,
72095164,
00142108,
00283837,
72127317,
09005500,
70289964,
00273689,
00285050,
00284347,
70768480,
00151248,
00243582,
09044799,
00255674,
00260244,
70857512,
70134375,
00285049,
00284346,
00163060,
00260269,
72613394,
00298938,
71293396,
00263465,
09057677,
00308907,
00276595,
00302945,
72094419,
00157147,
00173851,
00306206,
00270065,
00252857,
00174606,
00250385,
00130072,
72600888,
70256292,
00259935,
00278774,
09014792,
71293400,
00259415,
09044192,
09050261,
00288317,
00252527,
00299489,
72026952,
00146835,
00079699,
72094540,
72095083,
09015282,
00306207,
00282058,
09084172,
00260242,
00133946,
00299550,
71322280,
00276660,
00042003,
00278782,
09004373,
00128256,
00146087,
72594780,
09023239,
00259726,
09091497,
00173804,
72094729,
72094788,
00320754,
00308877,
09013973,
00285627,
09071519,
72616180,
72647981,
71292764,
71293310,
00263470,
00263473,
00297072,
09030666,
00303822,
00252854,
00299493,
70352941,
70133891,
09015470,
78274354,
00160804,
72027185,
72027240,
09039224,
00334528,
70123420,
70186324,
00297665,
00152514,
09051646,
78241006,
72611103,
00289274,
72772786,
72595620,
72613378,
70350590,
70992061,
00243455,
71293337,
00239954,
09045677,
00252526,
09015042,
72308389,
00239967,
70119066,
00297957,
70111600,
72027282,
70991715,
09015473,
70195056,
00240692,
71222669,
00128058,
00257074,
71363238,
09036887,
70960461,
00079702,
72094648,
71326480,
00170122,
79413102,
00320329,
00276661,
00151618,
00248818,
72872810,
00320734,
00320735,
78337470,
00273691,
09085533,
00326315,
00258149,
00265309,
00265310,
09092951,
70344094,
00302234,
00285640,
00283264,
09071989,
00311185,
71292721,
09029054,
71293248,
71293515,
00263474,
00121147,
09057721,
78292166,
70115850,
09056931,
00105031,
72027320,
72027363,
00324967,
00263558,
00049323,
00274777,
00239944,
70133905,
00117317,
71218017,
00273617,
00299064,
00276683,
70878323,
70113440,
72027002,
72026910,
00243223,
00243131,
00243170,
09038145,
00302949,
79191320,
10102843,
72095008,
00260261,
00260262,
00161327,
00259421,
00250383,
70857563,
72611260,
72871911,
72872403,
72872438,
09088406,
78090407,
00278784,
00278689,
00173860,
09044425,
72615842,
09037378,
00285142,
78451329,
78451175,
70350477,
70992126,
00297223,
72020377,
09020051,
71292837,
71292845,
71293280,
71293302,
00263468,
09067443,
00299184,
00263853,
00269200,
70239622,
09088934,
72342943,
00259918,
00096063,
09067123,
00252848,
00252847,
00252843,
09061000,
00311575,
70111626,
09067602,
09076235,
00049324,
09077815,
00276652,
72025964,
09015468,
72026014,
72026383,
72025832,
00161323,
00240750,
71217932,
71217991,
71222820,
71222839,
71222812,
71222863,
71222928,
71222936,
09049183,
70352003,
70113467,
70113505,
72027061,
00276534,
73870056,
00313904,
00276597,
71362843,
00243142,
00243144,
00243173,
00157646,
79188877,
70891451,
70123470,
72095202,
00250376,
00261571,
00173825,
00282055,
78250455,
70346518,
72694386,
09066558,
00276659,
00313647,
00301250,
70134030,
00320337,
70854270,
72873787,
72871628,
72871695,
72873167,
00143997,
09094178,
09040177,
73057932,
00121602,
78473071,
78473314,
00278775,
00148418,
78275717,
00120056,
09032872,
00250371,
72613343,
00306175,
00164381,
00335152,
09075068,
00266858,
00299181,
72081295,
00335233,
00320343,
71292772,
71293230,
71293353,
71293361,
71293477,
00313648,
00121146,
00325218,
70984956,
70984840,
00297321,
00288313,
09054252,
00283260,
70985030,
00262150,
00239951,
00239952,
00307089,
72574615,
09067672,
09063873,
70240191,
71293590,
71293612,
71293752,
71293779,
00320311,
72594853,
00252842,
00255113,
71075267,
72611626,
72611979,
00297956,
00297955,
00319464,
72027347,
00259724,
00334573,
70991685,
00325770,
00335628,
00335629,
71344829,
71299165,
00328511,
00328553,
70104026,
00269957,
00274779,
09060431,
00239941,
09068345,
00276649,
00276656,
00276657,
72026294,
72026430,
72026472,
72026022,
09061952,
72025824,
72025930,
72026421,
72025867,
00293922,
76760383,
71218084,
71218114,
71222758,
71222766,
71222774,
71222731,
71222740,
71222847,
71222782,
71222898,
71222871,
71222880,
71222952,
71222677,
71222685,
71222693,
00240704,
71174435,
00276670,
00276681,
00263667,
00263671,
71002723,
70988781,
72027126,
00155403,
00155402,
72459832,
72459867,
00167714,
70982392,
70982775,
70982422,
70982430,
70982449,
70109648,
70982856,
70982546,
70982880,
70982937,
70984301,
09065908,
70349967,
00276594,
09033270,
09016922,
00243221,
00243098,
00243102,
00243134,
00243139,
00243127,
00243175,
00243194,
00243151,
00243140,
00166502,
70854394,
70110859,
00243580,
00257478,
70037841,
72598670,
72094680,
76613240,
00273995,
00273738,
00282054,
00282060,
00282061,
00270081,
00241339,
00260260,
00299389,
70343519,
09005442,
00301252,
72630027,
71214283,
72694246,
72694319,
71212469,
71212671,
72696702,
71212752,
72696800,
71212957,
72697075,
00005463,
00145659,
00276567,
00054763,
00105151,
00148987,
00299551,
00299552,
70347719,
09017331,
70346690,
00277325,
09025144,
72871636,
72871946,
72871970,
00001995,
00163066,
00325924,
00284727,
00247923,
00266410,
00173853,
00304164,
70251193,
00335441,
00273688,
09070033,
00121601,
00122847,
78472792,
78472261,
78472920,
00278783,
00278785,
00278699,
00278827,
00278865,
00297348,
00039245,
72595507,
72595566,
00286131,
71384677,
72613459,
00326101,
00304846)--= '70252980'
--AND ts.cd_tip_tuss in (00,19)
--and rownum > =1
group by
opme.cd_produto,
opme.ds_produto,
opme.cd_especie,
opme.cd_classe,
opme.ds_classe,
opme.cd_multi_empresa,
pf.cd_pro_fat,
pf.ds_pro_fat,
opme.cd_gru_pro,
opme.ds_gru_pro,
opme.cd_simpro,
opme.cd_tuss,
--ts.ds_tuss,
pf.ds_unidade
/*''DESC_SIMPRO,
''CLASS_SIMPRO,
''DESC_IDENTIFICACAO,
''CONSUMO_12_MESES_VALOR,
''CONSUMO_12_MESES,QTDADE*/

order by qtd desc
